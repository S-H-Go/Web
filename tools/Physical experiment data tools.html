<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/jpg" href="https://www.sweethg.club/wp-content/uploads/2021/08/loge.jpg" />
  <title>Document</title>
</head>
<style type="text/css">
  .input-output {
    border-color: rgb(56, 56, 102);
    border-radius: 1%;
    border-width: 0.5vw;
    width: 50vw;
    height: 15vh;
  }

  #input-block {
    margin-left: 20px;
    font-size: 16px;
    display: inline-flex;
    justify-content: center;
    flex-direction: column;
    flex-wrap: wrap;
    position: relative;
    width: 50vw;
  }

  #option-block {
    position: relative;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
  }

  .function-option {
    background-color: #FE9307;
    border-color: #FE9307;
    color: black;
    border-radius: 10%;
    width: 16vw;
    height: 10vh;
    margin: auto;
    margin-top: 1vh;
  }

  .function-option:hover {
    background-color:
      blue;
    border-radius: 10%;
    border-color: blue;
  }

  @media screen and (max-width: 400px) {
    #option-block {
      position: relative;
      display: inline-flex;
      flex-direction: row;
      flex-wrap: wrap;
      align-items: center;
      align-content: center;
    }

    #input-block {
      position: relative;
      display: inline-flex;
      width: 70vw;
      left: 0vw;
    }

    .function-option {
      font-size: 12px;
      line-height: 5px;
      border-radius: 10%;
      width: 30vw;
      height: 6vh;
      margin-top: 1vh;
    }

    .input-output {
      border-color: rgb(56, 56, 102);
      border-radius: 1%;
      border-width: 0.5vw;
      width: 70vw;
      height: 15vh;
    }
</style>

<body>
  <main id="input-block">
    <label for="input" class="form-label">在这里输入数据：</label>
    <textarea id="input" class="input-output" type="text" value=""></textarea>
    <label for="option-block" class="form-label">点击选项开始计算：</label>
    <div id="option-block">
      <button id="option-the-method-of-successional-difference" class="function-option">
        逐差法
      </button>
      <button id="option-item-by-item-sub" class="function-option">
        逐项相减
      </button>
      <button id="option-a-class-uncertainty" class="function-option">
        A类不确定度
      </button>
      <button id="option-sub" class="function-option">相减</button>
      <button id="option-square" class="function-option">平方</button>
      <button id="avg" class="function-option">平均值</button>
    </div>
    <label for="output" class="form-label">结果在这里：</label>
    <textarea id="output" class="input-output" type="text" value="输出"></textarea>
  </main>
  <script>
    var output = document.getElementById("output");
    var input = document.getElementById("input");
    var dataA = [],
      dataB = []; //输入数据
    var digit = 0; //位数
    var symbol = { interval: "/", group: "\)," }; //间隔和分割符号
    var optionZCF = document.getElementById(
      "option-the-method-of-successional-difference"
    );
    var optionZXXJ = document.getElementById("option-item-by-item-sub");
    var optionALBQDD = document.getElementById("option-a-class-uncertainty");
    var optionSUB = document.getElementById("option-sub");
    var optionPF = document.getElementById("option-square");
    var optionAVG = document.getElementById("avg");
    output.addEventListener("click", function () {
      this.setSelectionRange(0, this.value.length); //点击全选
    });
    optionZCF.addEventListener("click", zcf);
    optionZXXJ.addEventListener("click", zxxj);
    optionALBQDD.addEventListener("click", albqdd);
    optionSUB.addEventListener("click", sub);
    optionPF.addEventListener("click", square);
    optionAVG.addEventListener("click", avgs);
    function inputData() {
      digit = 0; //重置小数位数
      var input = document.getElementById("input");
      var strInput = input.value
        .replace(/\（/g, "(")
        .replace(/\）/g, ")")
        .replace(/，/g, ","); //替换为英文括号，逗号
      strInput = strInput.replace(/ /g, "").replace(/\n/g, ""); //删除空格和换行符
      var strData1, strData2;
      /*判断数据是否符合格式*/
      if (strInput == "") {
        alert("请输入数据后重试。");
        return false;
      }
      if (strInput[0] === "(" && strInput[strInput.length - 1] === ")") {
        if (strInput.match(/\//g) == null) {
          alert("数据格式有误。请检查数据格式后再试。");
          return false;
        }
        if (
          /*如果输入的是两组数据，则分开两组数据*/
          strInput.match(/\),/) != null
        ) {
          if (strInput.match(/\),/g).length > 1) {
            alert("您输入的数据大于2组，请检查数据后重试");
            return false;
          }
          strData1 = strInput.substring(1, strInput.indexOf(symbol.group));
          strData2 = strInput.substring(
            strInput.indexOf(symbol.group) + 3,
            strInput.length - 1
          );
          dataA = strData1.split(symbol.interval);
          dataB = strData2.split(symbol.interval);
          if (dataA.length != dataB.length) {
            alert("两组数据长度不相等，请检查数据后再试");
            return false;
          }
          for (let i = 0; i < dataA.length; i++) {
            if (
              isNumber(dataA[i]) === false ||
              isNumber(dataB[i]) === false
            ) {
              alert("数据不能为非数字，请检查数据后再试");
              return false;
            } else {
              //找到最大小数位数
              if (
                dataA[i].indexOf(".") != -1 ||
                dataB[i].indexOf(".") != -1
              ) {
                digit =
                  digit > dataA[i].length - 1 - dataA[i].indexOf(".")
                    ? digit
                    : dataA[i].length - 1 - dataA[i].indexOf(".");
                digit =
                  digit > dataB[i].length - 1 - dataB[i].indexOf(".")
                    ? digit
                    : dataB[i].length - 1 - dataB[i].indexOf(".");
              }
              //转换成数字
              dataA[i] = parseFloat(dataA[i]);
              dataB[i] = parseFloat(dataB[i]);
            }
          }
        } else {
          /*一组数据直接处理*/
          strData1 = strInput.substring(1, strInput.length - 1);
          //判断数据是否含有字母
          //分立开数据，并转换为数字
          dataA = strData1.split(symbol.interval);
          for (let i = 0; i < dataA.length; i++) {
            if (isNumber(dataA[i]) === false) {
              alert("数据不能为非数字，请检查数据后再试");
              return false;
            } else {
              //找到最大小数位数
              if (dataA[i].indexOf(".") != -1) {
                digit =
                  digit > dataA[i].length - 1 - dataA[i].indexOf(".")
                    ? digit
                    : dataA[i].length - 1 - dataA[i].indexOf(".");
              }
              //转换成数字
              dataA[i] = parseFloat(dataA[i]);
            }
          }
          strData2 = null;
          dataB = null;
        }
        //digit--; //多了一位，减去
        return true;
      } else {
        console.info(strInput);
        alert("数据格式有误。请检查数据格式后再试。");
        return false;
      }
    }
    //逐差法
    function zcf() {
      var result1 = [],
        result2 = [];
      if (inputData()) {
        if (dataA.length % 2 != 0) {
          alert("数据长度不为偶数，无法用逐差法处理，请检查数据后重试。");
        } else if (dataB != null) {
          for (let i = 0; i < dataA.length / 2; i++) {
            result1[i] = (
              (dataA[i + dataA.length / 2] - dataA[i]) /
              (dataA.length / 2)
            ).toFixed(digit);
            result2[i] = (
              (dataB[i + dataB.length / 2] - dataB[i]) /
              (dataB.length / 2)
            ).toFixed(digit);
          }
          output.value = numArr2str(result1).concat(
            "\n,",
            numArr2str(result2)
          );
        } else {
          for (let i = 0; i < dataA.length / 2; i++) {
            result1[i] = (
              (dataA[i + dataA.length / 2] - dataA[i]) /
              (dataA.length / 2)
            ).toFixed(digit);
          }
          output.value = numArr2str(result1);
        }
      }
    }
    //逐项相减
    function zxxj() {
      var result1 = [];
      if (inputData()) {
        if (dataB != null) {
          var result2 = [];
          for (let i = 0; i < dataA.length - 1; i++) {
            result1[i] = (dataA[i + 1] - dataA[i]).toFixed(digit);
            result2[i] = (dataB[i + 1] - dataB[i]).toFixed(digit);
          }
          output.value = numArr2str(result1).concat(",", numArr2str(result2));
        } else {
          for (let i = 0; i < dataA.length - 1; i++) {
            result1[i] = (dataA[i + 1] - dataA[i]).toFixed(digit);
          }
          output.value = numArr2str(result1);
        }
      }
    }
    //A类不确定度
    function albqdd() {
      //分子和分母
      var molecule1 = 0,
        molecule2 = 0,
        denominator1 = 0,
        denominator2 = 0;
      if (inputData()) {
        var avg1 = avg(dataA);
        if (dataB != null) {
          var avg2 = avg(dataB);
          denominator1 = (dataA.length - 1) * dataA.length;
          denominator2 = (dataA.length - 1) * dataA.length;
          for (let i = 0; i < dataA.length; i++) {
            molecule1 += Math.pow(dataA[i] - avg1, 2);
            molecule2 += Math.pow(dataB[i] - avg2, 2);
          }
          output.value =
            "(" +
            Math.sqrt(molecule1 / denominator1).toFixed(digit) +
            "),(" +
            Math.sqrt(molecule2 / denominator2).toFixed(digit) +
            ")";
        } else {
          denominator1 = (dataA.length - 1) * dataA.length;
          for (let i = 0; i < dataA.length; i++) {
            molecule1 += Math.pow(dataA[i] - avg1, 2);
          }
          output.value =
            "(" + Math.sqrt(molecule1 / denominator1).toFixed(digit) + ")";
        }
      }
    }
    //相减
    function sub() {
      if (inputData()) {
        if (dataB != null) {
          let result = [];
          for (let i = 0; i < dataA.length; i++) {
            result[i] = (dataA[i] - dataB[i]).toFixed(digit);
          }
          output.value = numArr2str(result);
        } else {
          alert("只有一组数据无法进行相减，请检查数据后重试。");
        }
      }
    }
    //平方
    function square() {
      if (inputData()) {
        if (dataB != null) {
          for (let i = 0; i < dataA.length; i++) {
            dataA[i] = (dataA[i] ** 2).toFixed(digit * 2);
            dataB[i] = (dataB[i] ** 2).toFixed(digit * 2);
          }
          output.value = numArr2str(dataA) + "," + numArr2str(dataB);
        } else {
          for (let i = 0; i < dataA.length; i++) {
            dataA[i] = (dataA[i] ** 2).toFixed(digit);
          }
          output.value = numArr2str(dataA);
        }
      }
    }
    //求平均值
    function avgs() {
      if (inputData()) {
        if (dataB != null) {
          output.value =
            "(" + avg(dataA).toString().concat("),(", avg(dataB)) + ")";
        } else {
          output.value = "(" + avg(dataA).toString() + ")";
        }
      }
    }
    //平均值
    function avg(arrA) {
      var sum = 0;
      for (let i = 0; i < arrA.length; i++) {
        sum += arrA[i];
      }
      return sum / arrA.length;
    }
    //将结果数组转换成固定格式
    function numArr2str(numArr) {
      var str = "(";
      for (let i = 0; i < numArr.length; i++) {
        str = str.concat(numArr[i].toString());
        if (i != numArr.length - 1) {
          str = str.concat(symbol.interval, "  ");
        }
      }
      str = str.concat(")");
      return str;
    }
    //判断是否为数字
    function isNumber(val) {
      if (parseFloat(val).toString() == "NaN") {
        return false;
      } else {
        return true;
      }
    }
  </script>
</body>

</html>
